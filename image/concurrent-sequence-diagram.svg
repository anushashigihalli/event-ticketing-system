<svg viewBox="0 0 980 980" xmlns="http://www.w3.org/2000/svg" font-family="'Courier New', monospace">
  <defs>
    <marker id="arr" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
      <polygon points="0 0,10 3.5,0 7" fill="#334155"/>
    </marker>
    <marker id="arr-dash" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
      <polygon points="0 0,10 3.5,0 7" fill="#64748b"/>
    </marker>
    <marker id="arr-red" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
      <polygon points="0 0,10 3.5,0 7" fill="#dc2626"/>
    </marker>
    <filter id="sh">
      <feDropShadow dx="1" dy="2" stdDeviation="2" flood-color="#00000018"/>
    </filter>
  </defs>

  <!-- Background -->
  <rect width="980" height="980" fill="#ffffff"/>
  <line x1="0" y1="100" x2="980" y2="100" stroke="#e2e8f0" stroke-width="1"/>
  <line x1="0" y1="880" x2="980" y2="880" stroke="#e2e8f0" stroke-width="1"/>

  <!-- Title bar -->
  <rect x="0" y="0" width="980" height="48" fill="#f1f5f9"/>
  <text x="490" y="30" text-anchor="middle" font-size="15" font-weight="bold" fill="#0f172a" letter-spacing="1">Mutex Concurrency â€” Sequence Diagram</text>
  <text x="490" y="44" text-anchor="middle" font-size="10" fill="#64748b" letter-spacing="0.5">Two bookings succeed  Â·  One rejected (no seats)</text>

  <!--
    LIFELINE X POSITIONS:
      User A  = 100
      User B  = 270
      Server  = 490
      Database = 760   (pushed right for more label space)
  -->

  <!-- Lifeline headers -->
  <rect x="48"  y="58" width="104" height="36" rx="4" fill="#dbeafe" stroke="#3b82f6" stroke-width="1.5" filter="url(#sh)"/>
  <text x="100" y="72"  text-anchor="middle" font-size="9"  font-style="italic" fill="#1d4ed8">Â«actorÂ»</text>
  <text x="100" y="87"  text-anchor="middle" font-size="11" font-weight="bold"  fill="#1e3a8a">User A</text>

  <rect x="218" y="58" width="104" height="36" rx="4" fill="#d1fae5" stroke="#10b981" stroke-width="1.5" filter="url(#sh)"/>
  <text x="270" y="72"  text-anchor="middle" font-size="9"  font-style="italic" fill="#047857">Â«actorÂ»</text>
  <text x="270" y="87"  text-anchor="middle" font-size="11" font-weight="bold"  fill="#064e3b">User B</text>

  <rect x="438" y="58" width="104" height="36" rx="4" fill="#fef3c7" stroke="#f59e0b" stroke-width="1.5" filter="url(#sh)"/>
  <text x="490" y="72"  text-anchor="middle" font-size="9"  font-style="italic" fill="#b45309">Â«mutex/serverÂ»</text>
  <text x="490" y="87"  text-anchor="middle" font-size="11" font-weight="bold"  fill="#78350f">Server</text>

  <rect x="708" y="58" width="104" height="36" rx="4" fill="#ede9fe" stroke="#7c3aed" stroke-width="1.5" filter="url(#sh)"/>
  <text x="760" y="72"  text-anchor="middle" font-size="9"  font-style="italic" fill="#6d28d9">Â«databaseÂ»</text>
  <text x="760" y="87"  text-anchor="middle" font-size="11" font-weight="bold"  fill="#4c1d95">Database</text>

  <!-- LIFELINES -->
  <line x1="100" y1="94"  x2="100" y2="870" stroke="#3b82f6" stroke-width="1" stroke-dasharray="6 4" opacity="0.6"/>
  <line x1="270" y1="94"  x2="270" y2="870" stroke="#10b981" stroke-width="1" stroke-dasharray="6 4" opacity="0.6"/>
  <line x1="490" y1="94"  x2="490" y2="870" stroke="#f59e0b" stroke-width="1" stroke-dasharray="6 4" opacity="0.6"/>
  <line x1="760" y1="94"  x2="760" y2="870" stroke="#7c3aed" stroke-width="1" stroke-dasharray="6 4" opacity="0.6"/>

  <!-- SECTION LABEL -->
  <rect x="28" y="106" width="460" height="16" rx="3" fill="#e2e8f0"/>
  <text x="258" y="118" text-anchor="middle" font-size="9" fill="#475569" letter-spacing="1">CONCURRENT REQUESTS</text>

  <!-- User A â†’ Server: POST -->
  <line x1="108" y1="132" x2="482" y2="132" stroke="#3b82f6" stroke-width="1.6" marker-end="url(#arr)"/>
  <text x="295" y="126" text-anchor="middle" font-size="10" font-weight="bold" fill="#1d4ed8">POST /bookings</text>

  <!-- User B â†’ Server: POST -->
  <line x1="278" y1="148" x2="482" y2="148" stroke="#10b981" stroke-width="1.6" marker-end="url(#arr)"/>
  <text x="380" y="142" text-anchor="middle" font-size="10" font-weight="bold" fill="#047857">POST /bookings</text>

  <!-- Lock badge A -->
  <rect x="380" y="158" width="224" height="20" rx="10" fill="#fef9c3" stroke="#f59e0b" stroke-width="1"/>
  <text x="492" y="172" text-anchor="middle" font-size="9" font-weight="bold" fill="#92400e">ðŸ”’ Lock Acquired â€” User A</text>

  <!-- Activation bars -->
  <rect x="482" y="178" width="16" height="178" rx="2" fill="#fde68a" stroke="#f59e0b" stroke-width="1"/>
  <rect x="92"  y="130" width="16" height="390" rx="2" fill="#bfdbfe" stroke="#3b82f6" stroke-width="1"/>

  <!-- Processing box A -->
  <rect x="408" y="180" width="168" height="26" rx="3" fill="#fffbeb" stroke="#f59e0b" stroke-width="1"/>
  <text x="492" y="192" text-anchor="middle" font-size="9" font-style="italic" fill="#b45309">Â«processingÂ»  User A</text>
  <text x="492" y="203" text-anchor="middle" font-size="8" fill="#64748b">booking: qty=1</text>

  <!-- BEGIN TX A -->
  <line x1="498" y1="220" x2="752" y2="220" stroke="#7c3aed" stroke-width="1.5" marker-end="url(#arr)"/>
  <text x="627" y="214" text-anchor="middle" font-size="9" fill="#6d28d9">BEGIN TRANSACTION</text>

  <!-- SELECT 2 seats -->
  <line x1="498" y1="244" x2="752" y2="244" stroke="#7c3aed" stroke-width="1.5" marker-end="url(#arr)"/>
  <text x="627" y="238" text-anchor="middle" font-size="9" fill="#6d28d9">SELECT available WHERE id=1</text>
  <line x1="752" y1="262" x2="498" y2="262" stroke="#94a3b8" stroke-width="1.4" stroke-dasharray="5 3" marker-end="url(#arr-dash)"/>
  <text x="627" y="257" text-anchor="middle" font-size="9" fill="#475569">available = 2</text>

  <!-- UPDATE 1 seat -->
  <line x1="498" y1="282" x2="752" y2="282" stroke="#7c3aed" stroke-width="1.5" marker-end="url(#arr)"/>
  <text x="627" y="276" text-anchor="middle" font-size="9" fill="#6d28d9">UPDATE available = 1</text>

  <!-- COMMIT A -->
  <line x1="498" y1="304" x2="752" y2="304" stroke="#7c3aed" stroke-width="1.5" marker-end="url(#arr)"/>
  <text x="627" y="298" text-anchor="middle" font-size="9" font-weight="bold" fill="#6d28d9">COMMIT</text>
  <line x1="752" y1="320" x2="498" y2="320" stroke="#94a3b8" stroke-width="1.4" stroke-dasharray="5 3" marker-end="url(#arr-dash)"/>
  <text x="627" y="315" text-anchor="middle" font-size="9" fill="#475569">OK</text>

  <!-- DB activation bar (User A) -->
  <rect x="752" y="218" width="16" height="116" rx="2" fill="#ddd6fe" stroke="#7c3aed" stroke-width="1"/>

  <!-- Seq numbers A -->
  <circle cx="108" cy="132" r="9" fill="#3b82f6"/><text x="108" y="136" text-anchor="middle" font-size="9" fill="#fff" font-weight="bold">1</text>
  <circle cx="498" cy="220" r="9" fill="#7c3aed"/><text x="498" y="224" text-anchor="middle" font-size="9" fill="#fff" font-weight="bold">2</text>
  <circle cx="498" cy="244" r="9" fill="#7c3aed"/><text x="498" y="248" text-anchor="middle" font-size="9" fill="#fff" font-weight="bold">3</text>
  <circle cx="752" cy="262" r="9" fill="#7c3aed"/><text x="752" y="266" text-anchor="middle" font-size="9" fill="#fff" font-weight="bold">4</text>
  <circle cx="498" cy="282" r="9" fill="#7c3aed"/><text x="498" y="286" text-anchor="middle" font-size="9" fill="#fff" font-weight="bold">5</text>
  <circle cx="498" cy="304" r="9" fill="#7c3aed"/><text x="498" y="308" text-anchor="middle" font-size="9" fill="#fff" font-weight="bold">6</text>

  <!-- UNLOCK A -->
  <rect x="380" y="332" width="224" height="20" rx="10" fill="#d1fae5" stroke="#10b981" stroke-width="1"/>
  <text x="492" y="346" text-anchor="middle" font-size="9" font-weight="bold" fill="#065f46">ðŸ”“ Unlock â€” User B acquires</text>

  <!-- 201 Created â†’ User A -->
  <line x1="482" y1="364" x2="108" y2="364" stroke="#16a34a" stroke-width="1.6" stroke-dasharray="5 3" marker-end="url(#arr-dash)"/>
  <text x="295" y="357" text-anchor="middle" font-size="10" font-weight="bold" fill="#15803d">201 Created</text>
  <circle cx="482" cy="364" r="9" fill="#16a34a"/><text x="482" y="368" text-anchor="middle" font-size="9" fill="#fff" font-weight="bold">7</text>

  <!-- USER B PROCESSING -->
  <rect x="482" y="378" width="16" height="178" rx="2" fill="#bbf7d0" stroke="#10b981" stroke-width="1"/>
  <rect x="262" y="146" width="16" height="430" rx="2" fill="#a7f3d0" stroke="#10b981" stroke-width="1"/>

  <!-- Processing box B -->
  <rect x="408" y="380" width="168" height="26" rx="3" fill="#f0fdf4" stroke="#10b981" stroke-width="1"/>
  <text x="492" y="392" text-anchor="middle" font-size="9" font-style="italic" fill="#047857">Â«processingÂ»  User B</text>
  <text x="492" y="403" text-anchor="middle" font-size="8" fill="#64748b">booking: qty=1</text>

  <!-- BEGIN TX B -->
  <line x1="498" y1="420" x2="752" y2="420" stroke="#7c3aed" stroke-width="1.5" marker-end="url(#arr)"/>
  <text x="627" y="414" text-anchor="middle" font-size="9" fill="#6d28d9">BEGIN TRANSACTION</text>

  <!-- SELECT 1 seat -->
  <line x1="498" y1="444" x2="752" y2="444" stroke="#7c3aed" stroke-width="1.5" marker-end="url(#arr)"/>
  <text x="627" y="438" text-anchor="middle" font-size="9" fill="#6d28d9">SELECT available WHERE id=1</text>
  <line x1="752" y1="462" x2="498" y2="462" stroke="#94a3b8" stroke-width="1.4" stroke-dasharray="5 3" marker-end="url(#arr-dash)"/>
  <text x="627" y="457" text-anchor="middle" font-size="9" fill="#475569">available = 1</text>

  <!-- UPDATE 0 seats -->
  <line x1="498" y1="482" x2="752" y2="482" stroke="#7c3aed" stroke-width="1.5" marker-end="url(#arr)"/>
  <text x="627" y="476" text-anchor="middle" font-size="9" fill="#6d28d9">UPDATE available = 0</text>

  <!-- COMMIT B -->
  <line x1="498" y1="504" x2="752" y2="504" stroke="#7c3aed" stroke-width="1.5" marker-end="url(#arr)"/>
  <text x="627" y="498" text-anchor="middle" font-size="9" font-weight="bold" fill="#6d28d9">COMMIT</text>
  <line x1="752" y1="520" x2="498" y2="520" stroke="#94a3b8" stroke-width="1.4" stroke-dasharray="5 3" marker-end="url(#arr-dash)"/>
  <text x="627" y="515" text-anchor="middle" font-size="9" fill="#475569">OK</text>

  <!-- DB activation bar (User B) -->
  <rect x="752" y="418" width="16" height="116" rx="2" fill="#ddd6fe" stroke="#7c3aed" stroke-width="1"/>

  <!-- Seq numbers B -->
  <circle cx="278" cy="148" r="9" fill="#10b981"/><text x="278" y="152" text-anchor="middle" font-size="9" fill="#fff" font-weight="bold">1</text>
  <circle cx="498" cy="420" r="9" fill="#7c3aed"/><text x="498" y="424" text-anchor="middle" font-size="9" fill="#fff" font-weight="bold">8</text>
  <circle cx="498" cy="444" r="9" fill="#7c3aed"/><text x="498" y="448" text-anchor="middle" font-size="9" fill="#fff" font-weight="bold">9</text>
  <circle cx="752" cy="462" r="9" fill="#7c3aed"/><text x="752" y="466" text-anchor="middle" font-size="9" fill="#fff" font-weight="bold">10</text>
  <circle cx="498" cy="482" r="9" fill="#7c3aed"/><text x="498" y="486" text-anchor="middle" font-size="9" fill="#fff" font-weight="bold">11</text>
  <circle cx="498" cy="504" r="9" fill="#7c3aed"/><text x="498" y="508" text-anchor="middle" font-size="9" fill="#fff" font-weight="bold">12</text>

  <!-- UNLOCK B -->
  <rect x="380" y="532" width="224" height="20" rx="10" fill="#f1f5f9" stroke="#94a3b8" stroke-width="1"/>
  <text x="492" y="546" text-anchor="middle" font-size="9" font-weight="bold" fill="#475569">ðŸ”“ Unlock</text>

  <!-- 201 Created â†’ User B -->
  <line x1="482" y1="562" x2="278" y2="562" stroke="#16a34a" stroke-width="1.6" stroke-dasharray="5 3" marker-end="url(#arr-dash)"/>
  <text x="380" y="555" text-anchor="middle" font-size="10" font-weight="bold" fill="#15803d">201 Created</text>
  <circle cx="482" cy="562" r="9" fill="#16a34a"/><text x="482" y="566" text-anchor="middle" font-size="9" fill="#fff" font-weight="bold">13</text>

  <!-- DIVIDER: USER C -->
  <line x1="28" y1="582" x2="950" y2="582" stroke="#cbd5e1" stroke-width="1" stroke-dasharray="4 4"/>
  <rect x="28" y="588" width="904" height="16" rx="3" fill="#fee2e2"/>
  <text x="490" y="600" text-anchor="middle" font-size="9" fill="#991b1b" letter-spacing="1">USER C â€” NO SEATS REMAINING</text>

  <!-- User C lifeline header -->
  <rect x="48" y="610" width="104" height="36" rx="4" fill="#fee2e2" stroke="#ef4444" stroke-width="1.5" filter="url(#sh)"/>
  <text x="100" y="624" text-anchor="middle" font-size="9"  font-style="italic" fill="#dc2626">Â«actorÂ»</text>
  <text x="100" y="639" text-anchor="middle" font-size="11" font-weight="bold"  fill="#7f1d1d">User C</text>

  <!-- User C lifeline -->
  <line x1="100" y1="646" x2="100" y2="870" stroke="#ef4444" stroke-width="1" stroke-dasharray="6 4" opacity="0.6"/>
  <!-- User C activation bar -->
  <rect x="92" y="668" width="16" height="186" rx="2" fill="#fecaca" stroke="#ef4444" stroke-width="1"/>

  <!-- User C â†’ Server POST -->
  <line x1="108" y1="668" x2="482" y2="668" stroke="#ef4444" stroke-width="1.6" marker-end="url(#arr-red)"/>
  <text x="295" y="661" text-anchor="middle" font-size="10" font-weight="bold" fill="#dc2626">POST /bookings</text>
  <circle cx="108" cy="668" r="9" fill="#dc2626"/><text x="108" y="672" text-anchor="middle" font-size="9" fill="#fff" font-weight="bold">14</text>

  <!-- Lock badge C -->
  <rect x="380" y="678" width="224" height="20" rx="10" fill="#fef9c3" stroke="#f59e0b" stroke-width="1"/>
  <text x="492" y="692" text-anchor="middle" font-size="9" font-weight="bold" fill="#92400e">ðŸ”’ Lock Acquired â€” User C</text>

  <!-- Server activation bar (C) -->
  <rect x="482" y="698" width="16" height="140" rx="2" fill="#fecaca" stroke="#ef4444" stroke-width="1"/>

  <!-- Processing box C -->
  <rect x="408" y="700" width="168" height="26" rx="3" fill="#fff1f2" stroke="#ef4444" stroke-width="1"/>
  <text x="492" y="712" text-anchor="middle" font-size="9" font-style="italic" fill="#dc2626">Â«processingÂ»  User C</text>
  <text x="492" y="723" text-anchor="middle" font-size="8" fill="#64748b">booking: qty=1</text>

  <!-- BEGIN TX C -->
  <line x1="498" y1="738" x2="752" y2="738" stroke="#7c3aed" stroke-width="1.5" marker-end="url(#arr)"/>
  <text x="627" y="732" text-anchor="middle" font-size="9" fill="#6d28d9">BEGIN TRANSACTION</text>

  <!-- SELECT 0 seats -->
  <line x1="498" y1="758" x2="752" y2="758" stroke="#7c3aed" stroke-width="1.5" marker-end="url(#arr)"/>
  <text x="627" y="752" text-anchor="middle" font-size="9" fill="#6d28d9">SELECT available WHERE id=1</text>
  <line x1="752" y1="774" x2="498" y2="774" stroke="#94a3b8" stroke-width="1.4" stroke-dasharray="5 3" marker-end="url(#arr-dash)"/>
  <text x="627" y="769" text-anchor="middle" font-size="9" fill="#475569">available = 0</text>

  <!-- DB activation bar (C) -->
  <rect x="752" y="736" width="16" height="54" rx="2" fill="#ddd6fe" stroke="#7c3aed" stroke-width="1"/>

  <!-- Guard check FAIL -->
  <rect x="406" y="782" width="172" height="20" rx="3" fill="#fee2e2" stroke="#ef4444" stroke-width="1"/>
  <text x="492" y="796" text-anchor="middle" font-size="9" font-weight="bold" fill="#dc2626">[guard]  0 &lt; 1  âœ—  FAIL</text>

  <!-- ROLLBACK -->
  <line x1="498" y1="810" x2="752" y2="810" stroke="#ef4444" stroke-width="1.5" marker-end="url(#arr-red)"/>
  <text x="627" y="804" text-anchor="middle" font-size="9" font-weight="bold" fill="#dc2626">ROLLBACK</text>

  <!-- Unlock C -->
  <rect x="380" y="820" width="224" height="20" rx="10" fill="#f1f5f9" stroke="#94a3b8" stroke-width="1"/>
  <text x="492" y="834" text-anchor="middle" font-size="9" font-weight="bold" fill="#475569">ðŸ”“ Unlock</text>

  <!-- 409 Conflict â†’ User C -->
  <line x1="482" y1="850" x2="108" y2="850" stroke="#ef4444" stroke-width="1.6" stroke-dasharray="5 3" marker-end="url(#arr-red)"/>
  <text x="295" y="843" text-anchor="middle" font-size="10" font-weight="bold" fill="#dc2626">409 Conflict</text>

  <!-- Seq numbers C -->
  <circle cx="498" cy="738" r="9" fill="#7c3aed"/><text x="498" y="742" text-anchor="middle" font-size="9" fill="#fff" font-weight="bold">15</text>
  <circle cx="498" cy="758" r="9" fill="#7c3aed"/><text x="498" y="762" text-anchor="middle" font-size="9" fill="#fff" font-weight="bold">16</text>
  <circle cx="752" cy="774" r="9" fill="#7c3aed"/><text x="752" y="778" text-anchor="middle" font-size="9" fill="#fff" font-weight="bold">17</text>
  <circle cx="498" cy="810" r="9" fill="#dc2626"/><text x="498" y="814" text-anchor="middle" font-size="9" fill="#fff" font-weight="bold">18</text>
  <circle cx="482" cy="850" r="9" fill="#dc2626"/><text x="482" y="854" text-anchor="middle" font-size="9" fill="#fff" font-weight="bold">19</text>

  <!-- Error response note â€” wider box -->
  <rect x="28" y="857" width="240" height="34" rx="3" fill="#fff1f2" stroke="#ef4444" stroke-width="1" stroke-dasharray="3 2"/>
  <text x="42" y="871" font-size="9" fill="#dc2626">{ success: false,</text>
  <text x="42" y="885" font-size="9" fill="#dc2626">  message: "Not enough seats" }</text>

  <!-- Footer lifeline boxes -->
  <rect x="48"  y="894" width="104" height="18" rx="4" fill="#dbeafe" stroke="#3b82f6" stroke-width="1.5"/>
  <text x="100" y="907" text-anchor="middle" font-size="10" fill="#1e3a8a">User A</text>
  <rect x="218" y="894" width="104" height="18" rx="4" fill="#d1fae5" stroke="#10b981" stroke-width="1.5"/>
  <text x="270" y="907" text-anchor="middle" font-size="10" fill="#064e3b">User B</text>
  <rect x="438" y="894" width="104" height="18" rx="4" fill="#fef3c7" stroke="#f59e0b" stroke-width="1.5"/>
  <text x="490" y="907" text-anchor="middle" font-size="10" fill="#78350f">Server</text>
  <rect x="708" y="894" width="104" height="18" rx="4" fill="#ede9fe" stroke="#7c3aed" stroke-width="1.5"/>
  <text x="760" y="907" text-anchor="middle" font-size="10" fill="#4c1d95">Database</text>

  <!-- Legend â€” safely within canvas -->
  <rect x="848" y="110" width="118" height="138" rx="4" fill="#f8fafc" stroke="#cbd5e1" stroke-width="1"/>
  <text x="907" y="128" text-anchor="middle" font-size="9" font-weight="bold" fill="#334155" letter-spacing="1">LEGEND</text>
  <line x1="860" y1="142" x2="896" y2="142" stroke="#334155" stroke-width="1.5"/>
  <text x="904" y="146" font-size="8" fill="#475569">sync call</text>
  <line x1="860" y1="158" x2="896" y2="158" stroke="#94a3b8" stroke-width="1.4" stroke-dasharray="5 3"/>
  <text x="904" y="162" font-size="8" fill="#475569">return</text>
  <rect x="860" y="170" width="16" height="10" rx="1" fill="#fde68a" stroke="#f59e0b" stroke-width="1"/>
  <text x="882" y="180" font-size="8" fill="#475569">activation</text>
  <circle cx="868" cy="198" r="7" fill="#3b82f6"/><text x="868" y="202" text-anchor="middle" font-size="8" fill="#fff">n</text>
  <text x="882" y="202" font-size="8" fill="#475569">seq no.</text>
  <rect x="860" y="212" width="38" height="16" rx="8" fill="#fef9c3" stroke="#f59e0b" stroke-width="1"/>
  <text x="879" y="224" text-anchor="middle" font-size="7" fill="#92400e">ðŸ”’ lock</text>
  <text x="904" y="224" font-size="8" fill="#475569">mutex</text>

</svg>
