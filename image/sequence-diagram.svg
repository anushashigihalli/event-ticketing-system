<svg viewBox="0 0 720 720" xmlns="http://www.w3.org/2000/svg" font-family="'Courier New', monospace">
  <defs>
    <marker id="arr" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#334155"/>
    </marker>
    <marker id="arr-open" markerWidth="10" markerHeight="8" refX="9" refY="4" orient="auto">
      <polyline points="0,0 9,4 0,8" fill="none" stroke="#334155" stroke-width="1.5"/>
    </marker>
    <marker id="arr-self" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#f59e0b"/>
    </marker>
    <filter id="sh" x="-8%" y="-8%" width="116%" height="116%">
      <feDropShadow dx="1" dy="2" stdDeviation="2" flood-color="#00000018"/>
    </filter>
  </defs>

  <!-- Background -->
  <rect width="720" height="720" fill="#f8fafc"/>

  <!-- Title -->
  <text x="360" y="28" text-anchor="middle" font-size="14" font-weight="bold" fill="#0f172a" letter-spacing="0.5">«sequence» POST /bookings — Happy Path</text>

  <!-- ─── Lifeline headers ─────────────────────────────────── -->
  <!-- User A -->
  <rect x="50" y="42" width="110" height="44" rx="4" fill="#fff" stroke="#38bdf8" stroke-width="1.8" filter="url(#sh)"/>
  <text x="105" y="60" text-anchor="middle" font-size="9" font-style="italic" fill="#0369a1">«actor»</text>
  <text x="105" y="76" text-anchor="middle" font-size="12" font-weight="bold" fill="#0f172a">User A</text>

  <!-- Server -->
  <rect x="290" y="42" width="140" height="44" rx="4" fill="#fff" stroke="#22c55e" stroke-width="1.8" filter="url(#sh)"/>
  <text x="360" y="60" text-anchor="middle" font-size="9" font-style="italic" fill="#15803d">«component»</text>
  <text x="360" y="76" text-anchor="middle" font-size="12" font-weight="bold" fill="#0f172a">Server</text>

  <!-- Database -->
  <rect x="550" y="42" width="120" height="44" rx="4" fill="#fff" stroke="#a78bfa" stroke-width="1.8" filter="url(#sh)"/>
  <text x="610" y="60" text-anchor="middle" font-size="9" font-style="italic" fill="#6d28d9">«database»</text>
  <text x="610" y="76" text-anchor="middle" font-size="12" font-weight="bold" fill="#0f172a">Database</text>

  <!-- ─── Lifelines ─────────────────────────────────────────── -->
  <line x1="105" y1="86" x2="105" y2="694" stroke="#38bdf8" stroke-width="1.5" stroke-dasharray="6 4"/>
  <line x1="360" y1="86" x2="360" y2="694" stroke="#22c55e" stroke-width="1.5" stroke-dasharray="6 4"/>
  <line x1="610" y1="86" x2="610" y2="694" stroke="#a78bfa" stroke-width="1.5" stroke-dasharray="6 4"/>

  <!-- ─── Activation bars ───────────────────────────────────── -->
  <!-- Server active for duration of request -->
  <rect x="352" y="108" width="16" height="530" rx="2" fill="#bbf7d0" stroke="#22c55e" stroke-width="1"/>
  <!-- DB active during transaction -->
  <rect x="602" y="168" width="16" height="390" rx="2" fill="#ede9fe" stroke="#a78bfa" stroke-width="1"/>
  <!-- User A activation during wait -->
  <rect x="97" y="108" width="16" height="530" rx="2" fill="#e0f2fe" stroke="#38bdf8" stroke-width="1"/>

  <!-- ─── Combined Fragment: loop/opt box (Transaction) ──────── -->
  <rect x="200" y="162" width="450" height="402" rx="3" fill="none" stroke="#f59e0b" stroke-width="1.5" stroke-dasharray="7 3"/>
  <rect x="200" y="162" width="90" height="18" rx="2" fill="#fef3c7" stroke="#f59e0b" stroke-width="1.5"/>
  <text x="245" y="175" text-anchor="middle" font-size="10" font-weight="bold" fill="#92400e">transaction</text>

  <!-- ─── Messages ──────────────────────────────────────────── -->

  <!-- 1. POST /bookings -->
  <line x1="113" y1="118" x2="350" y2="118" stroke="#334155" stroke-width="1.8" marker-end="url(#arr)"/>
  <text x="225" y="112" text-anchor="middle" font-size="10" font-weight="bold" fill="#0f172a">POST /bookings</text>
  <text x="225" y="128" text-anchor="middle" font-size="8" fill="#475569">{event_id, quantity, user_email}</text>

  <!-- 2. Lock Mutex (self-message) -->
  <path d="M 368 148 Q 415 148 415 158 Q 415 168 368 168" fill="none" stroke="#f59e0b" stroke-width="1.8" marker-end="url(#arr-self)"/>
  <text x="430" y="162" font-size="10" fill="#b45309" font-weight="bold">Lock Mutex</text>

  <!-- 3. BEGIN TRANSACTION -->
  <line x1="368" y1="188" x2="602" y2="188" stroke="#334155" stroke-width="1.8" marker-end="url(#arr)"/>
  <text x="487" y="182" text-anchor="middle" font-size="10" font-weight="bold" fill="#0f172a">BEGIN TRANSACTION</text>

  <!-- 4. SELECT available -->
  <line x1="368" y1="228" x2="602" y2="228" stroke="#334155" stroke-width="1.8" marker-end="url(#arr)"/>
  <text x="487" y="222" text-anchor="middle" font-size="10" fill="#0f172a">SELECT available WHERE id = event_id</text>

  <!-- 5. Return available = 10 -->
  <line x1="602" y1="258" x2="368" y2="258" stroke="#475569" stroke-width="1.5" stroke-dasharray="5 3" marker-end="url(#arr-open)"/>
  <text x="487" y="252" text-anchor="middle" font-size="10" fill="#475569">available = 10</text>

  <!-- 6. Guard check note -->
  <rect x="278" y="272" width="164" height="24" rx="3" fill="#f0fdf4" stroke="#4ade80" stroke-width="1"/>
  <text x="360" y="288" text-anchor="middle" font-size="10" fill="#15803d" font-weight="bold">[guard]  10 ≥ 2  ✓  proceed</text>

  <!-- 7. UPDATE available -->
  <line x1="368" y1="316" x2="602" y2="316" stroke="#334155" stroke-width="1.8" marker-end="url(#arr)"/>
  <text x="487" y="310" text-anchor="middle" font-size="10" fill="#0f172a">UPDATE events SET available = 8</text>

  <!-- 8. INSERT booking -->
  <line x1="368" y1="356" x2="602" y2="356" stroke="#334155" stroke-width="1.8" marker-end="url(#arr)"/>
  <text x="487" y="350" text-anchor="middle" font-size="10" fill="#0f172a">INSERT INTO bookings (...)</text>

  <!-- 9. COMMIT -->
  <line x1="368" y1="396" x2="602" y2="396" stroke="#334155" stroke-width="1.8" marker-end="url(#arr)"/>
  <text x="487" y="390" text-anchor="middle" font-size="10" font-weight="bold" fill="#0f172a">COMMIT</text>

  <!-- 10. ACK from DB -->
  <line x1="602" y1="426" x2="368" y2="426" stroke="#475569" stroke-width="1.5" stroke-dasharray="5 3" marker-end="url(#arr-open)"/>
  <text x="487" y="420" text-anchor="middle" font-size="10" fill="#475569">OK</text>

  <!-- 11. Unlock Mutex (self-message) -->
  <path d="M 368 458 Q 415 458 415 468 Q 415 478 368 478" fill="none" stroke="#f59e0b" stroke-width="1.8" marker-end="url(#arr-self)"/>
  <text x="430" y="472" font-size="10" fill="#b45309" font-weight="bold">Unlock Mutex</text>

  <!-- 12. 201 Created -->
  <line x1="352" y1="518" x2="113" y2="518" stroke="#475569" stroke-width="1.5" stroke-dasharray="5 3" marker-end="url(#arr-open)"/>
  <text x="225" y="510" text-anchor="middle" font-size="10" font-weight="bold" fill="#0f172a">201 Created</text>
  <text x="225" y="524" text-anchor="middle" font-size="9" fill="#475569">{ "success": true, "booking_id": "..." }</text>

  <!-- ─── Lifeline footers ──────────────────────────────────── -->
  <rect x="50" y="694" width="110" height="20" rx="4" fill="#fff" stroke="#38bdf8" stroke-width="1.5"/>
  <text x="105" y="708" text-anchor="middle" font-size="10" fill="#0f172a">User A</text>
  <rect x="290" y="694" width="140" height="20" rx="4" fill="#fff" stroke="#22c55e" stroke-width="1.5"/>
  <text x="360" y="708" text-anchor="middle" font-size="10" fill="#0f172a">Server</text>
  <rect x="550" y="694" width="120" height="20" rx="4" fill="#fff" stroke="#a78bfa" stroke-width="1.5"/>
  <text x="610" y="708" text-anchor="middle" font-size="10" fill="#0f172a">Database</text>

  <!-- ─── Sequence numbers ──────────────────────────────────── -->
  <circle cx="128" cy="118" r="8" fill="#0369a1"/>
  <text x="128" y="122" text-anchor="middle" font-size="9" fill="#fff" font-weight="bold">1</text>

  <circle cx="405" cy="148" r="8" fill="#f59e0b"/>
  <text x="405" y="152" text-anchor="middle" font-size="9" fill="#fff" font-weight="bold">2</text>

  <circle cx="383" cy="188" r="8" fill="#22c55e"/>
  <text x="383" y="192" text-anchor="middle" font-size="9" fill="#fff" font-weight="bold">3</text>

  <circle cx="383" cy="228" r="8" fill="#22c55e"/>
  <text x="383" y="232" text-anchor="middle" font-size="9" fill="#fff" font-weight="bold">4</text>

  <circle cx="587" cy="258" r="8" fill="#6d28d9"/>
  <text x="587" y="262" text-anchor="middle" font-size="9" fill="#fff" font-weight="bold">5</text>

  <circle cx="383" cy="316" r="8" fill="#22c55e"/>
  <text x="383" y="320" text-anchor="middle" font-size="9" fill="#fff" font-weight="bold">6</text>

  <circle cx="383" cy="356" r="8" fill="#22c55e"/>
  <text x="383" y="360" text-anchor="middle" font-size="9" fill="#fff" font-weight="bold">7</text>

  <circle cx="383" cy="396" r="8" fill="#22c55e"/>
  <text x="383" y="400" text-anchor="middle" font-size="9" fill="#fff" font-weight="bold">8</text>

  <circle cx="587" cy="426" r="8" fill="#6d28d9"/>
  <text x="587" y="430" text-anchor="middle" font-size="9" fill="#fff" font-weight="bold">9</text>

  <circle cx="405" cy="458" r="8" fill="#f59e0b"/>
  <text x="405" y="462" text-anchor="middle" font-size="9" fill="#fff" font-weight="bold">10</text>

  <circle cx="337" cy="518" r="8" fill="#0369a1"/>
  <text x="337" y="522" text-anchor="middle" font-size="9" fill="#fff" font-weight="bold">11</text>

</svg>
